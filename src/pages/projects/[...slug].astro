---
import Layout from '../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects
    .filter(project => !project.data.externalUrl)
    .map(project => ({
      params: { slug: project.slug },
      props: { project },
    }));
}

const { project } = Astro.props;
const { Content } = await render(project);
---

<Layout title={`${project.data.title} - Brad Bennett`}>
  <article class="max-w-4xl mx-auto px-6 py-12">
    <a href="/" class="text-[--color-text-muted] hover:text-[--color-accent] text-sm mb-8 inline-block">
      ‚Üê Back to Work
    </a>
    
    <header class="mb-8">
      <p class="text-sm text-[--color-text-muted] uppercase tracking-wide mb-2">{project.data.category}</p>
      <h1 class="text-4xl font-medium mb-4">{project.data.title}</h1>
      {project.data.year && (
        <p class="text-[--color-text-muted]">{project.data.year}</p>
      )}
    </header>

    {project.data.images && project.data.images.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-10">
        {project.data.images.map((img: string, i: number) => (
          <div class="bg-[--color-border] rounded-lg overflow-hidden">
            <img 
              src={img} 
              alt={`${project.data.title} - Image ${i + 1}`}
              class="w-full h-auto"
            />
          </div>
        ))}
      </div>
    ) : project.data.thumbnail && (
      <div class="aspect-square max-w-lg bg-[--color-border] rounded-lg overflow-hidden mb-8">
        <img 
          src={project.data.thumbnail} 
          alt={project.data.title}
          class="w-full h-full object-cover"
        />
      </div>
    )}

    <div class="prose prose-invert max-w-none">
      <Content />
    </div>
  </article>
</Layout>

<style>
  .prose {
    color: var(--color-text);
  }
  .prose h2, .prose h3 {
    color: var(--color-accent);
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  .prose p {
    margin-bottom: 1rem;
    line-height: 1.7;
  }
  .prose a {
    color: var(--color-accent);
    text-decoration: underline;
  }
  .prose ul, .prose ol {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }
  .prose li {
    margin-bottom: 0.5rem;
  }
  .prose img {
    border-radius: 0.5rem;
    margin: 1rem 0;
  }
</style>

<script>
  // Make all external links open in new tab
  document.querySelectorAll('.prose a[href^="http"]').forEach(link => {
    link.setAttribute('target', '_blank');
    link.setAttribute('rel', 'noopener noreferrer');
  });
</script>
